
CPPCOMPILE="g++ -std=c++11 -m32 -ffreestanding -O2 -Wall -Wextra -fno-exceptions -fno-rtti -c"
NASMCOMPILE="nasm -felf32"

LINKORDER="boot.o gdtasm.o gdt.o term.o begin.o"

echo Compiling
echo --Kernel--
$CPPCOMPILE ./system/begin.cpp -o ./bin/begin.o

echo --Memory Manager--
$CPPCOMPILE ./ram/fs.cpp -o ./bin/fs.o

echo --Library--
$CPPCOMPILE ./library/string.c -o ./bin/string.o

echo --System--
$CPPCOMPILE ./system/ports.cpp -o ./bin/ports.o
$CPPCOMPILE ./system/pic.cpp -o ./bin/pic.o
$NASMCOMPILE ./interrupts/interrupts.asm -o ./bin/interrupts.o

echo --System Terminal Display--

echo --Main Loader--
$NASMCOMPILE ./system/boot.asm -o ./bin/boot.o

echo
echo Linking
cd ./bin
gcc -m32 -T ../link.ld -o ../isodir/boot/myos.bin -ffreestanding -O2 -nostdlib $LINKORDER -lgcc
cd ..

echo #Packaging#
grub-mkrescue -o myos.iso isodir
