
CPPCOMPILE="g++ -std=c++11 -m32 -ffreestanding -O2 -Wall -Wextra -fno-exceptions -fno-rtti -c -I../"
NASMCOMPILE="nasm -felf32"

LINKORDER="boot.o terminal.o string.o fs.o pic.o error_handler.o IRQ_handler.o interrupts.o idt.o keyboard.o begin.o"

echo Compiling
echo --Kernel--
$CPPCOMPILE ./src/begin.cpp -o ./bin/begin.o

echo --Memory Manager--
$CPPCOMPILE ./src/ram_fs.cpp -o ./bin/ram_fs.o

echo --Drivers--
$CPPCOMPILE ./src/drivers/keyboard.cpp -o ./bin/keyboard.o

echo --System--
$CPPCOMPILE ./src/ports.cpp -o ./bin/ports.o
$CPPCOMPILE ./src/error_handler.cpp -o ./bin/error_handler.o
$CPPCOMPILE ./src/IRQ_handler.cpp -o ./bin/IRQ_handler.o
$CPPCOMPILE ./src/pic.cpp -o ./bin/pic.o
$CPPCOMPILE ./src/idt.cpp -o ./bin/idt.o
$NASMCOMPILE ./asm/interrupts.asm -o ./bin/interrupts.o

echo --Display--
$CPPCOMPILE ./src/terminal.cpp -o ./bin/terminal.o

echo --Main Loader--
$NASMCOMPILE ./asm/boot.asm -o ./bin/boot.o

echo
echo Linking
cd ./bin
gcc -m32 -T ../link.ld -o ../isodir/boot/myos.bin -ffreestanding -O2 -nostdlib $LINKORDER -lgcc
cd ..

echo #Packaging#
grub-mkrescue -o myos.iso isodir
