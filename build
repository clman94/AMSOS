
CPPCOMPILE="g++ -std=c++11 -m32 -ffreestanding -O2 -Wall -Wextra -fno-exceptions -fno-rtti -c"
NASMCOMPILE="nasm -felf32"

LINKORDER="boot.o terminal.o string.o fs.o pic.o error_handler.o IRQ_handler.o interrupts.o idt.o keyboard.o begin.o"

echo Compiling
echo --Kernel--
$CPPCOMPILE ./system/begin.cpp -o ./bin/begin.o

echo --Memory Manager--
$CPPCOMPILE ./ram/fs.cpp -o ./bin/fs.o

echo --Library--
$CPPCOMPILE ./library/string.c -o ./bin/string.o

echo --Drivers--
$CPPCOMPILE ./drivers/keyboard.cpp -o ./bin/keyboard.o

echo --System--
$CPPCOMPILE ./system/ports.cpp -o ./bin/ports.o
$CPPCOMPILE ./interrupts/error_handler.cpp -o ./bin/error_handler.o
$CPPCOMPILE ./interrupts/IRQ_handler.cpp -o ./bin/IRQ_handler.o
$CPPCOMPILE ./interrupts/pic.cpp -o ./bin/pic.o
$CPPCOMPILE ./interrupts/idt.cpp -o ./bin/idt.o
$NASMCOMPILE ./interrupts/interrupts.asm -o ./bin/interrupts.o

echo --Display--
$CPPCOMPILE ./display/terminal.cpp -o ./bin/terminal.o

echo --Main Loader--
$NASMCOMPILE ./system/boot.asm -o ./bin/boot.o

echo
echo Linking
cd ./bin
gcc -m32 -T ../link.ld -o ../isodir/boot/myos.bin -ffreestanding -O2 -nostdlib $LINKORDER -lgcc
cd ..

echo #Packaging#
grub-mkrescue -o myos.iso isodir
